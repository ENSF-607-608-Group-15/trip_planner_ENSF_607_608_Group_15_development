<form class="row g-3" id="tripForm" action="/trip_generator" method="POST">
  <div class="trip-form-container">
    <!-- Main inputs section -->
    <div class="input-group">
      <div class="form-field">
        <label for="inputCity" class="form-label">Departure City</label>
        <input type="text" class="form-control" id="inputCity" name="inputCity">
      </div>

      <div class="form-field">
        <label for="dDate" class="form-label">Departure Date</label>
        <div class="date-input-container">
            <input type="text" 
                   class="form-control" 
                   id="dDate" 
                   name="dDate"
                   placeholder="DD/MM/YYYY"
                   maxlength="10"
                   onkeyup="formatDateInput(this)">
            <input type="date" 
                   id="date-picker-hidden"
                   onchange="updateTextInput(this)"
                   tabindex="-1">
            <span id="date-picker-button"
                  aria-hidden="true"
              >ðŸ“…</span>
        </div>
      </div>
      
      <div class="form-field">
        <label for="rDate" class="form-label">Return Date</label>
        <div class="date-input-container">
            <input type="text" 
                   class="form-control" 
                   id="rDate" 
                   name="rDate"
                   placeholder="DD/MM/YYYY"
                   maxlength="10"
                   onkeyup="formatDateInput(this)">
            <input type="date" 
                   id="date-picker-hidden"
                   onchange="updateTextInput(this)"
                   tabindex="-1">
            <span id="date-picker-button"
                  aria-hidden="true"
              >ðŸ“…</span>
        </div>
      </div>

      <div class="form-field">
        <label for="tripLocation" class="form-label">Desired Trip Location</label> 
        <input type="text" class="form-control" id="tripLocation" name="tripLocation" placeholder="Enter your desired trip location">
      </div>

      <div class="form-field">
        <label for="tripBudget" class="form-label">Trip Budget</label> 
        <input type="number" class="form-control" id="tripBudget" name="tripBudget" placeholder="Enter your trip budget">
      </div>
    </div>

    <!-- Checkboxes section -->
    <div class="checkbox-group">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="noFlying" name="noFlying">
        <label class="form-check-label" for="noFlying">No Flying</label>
      </div>
      
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="disabilityFriendly" name="disabilityFriendly">
        <label class="form-check-label" for="disabilityFriendly">Disability Friendly</label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="familyFriendly" name="familyFriendly">
        <label class="form-check-label" for="familyFriendly">Family Friendly</label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="groupDiscount" name="groupDiscount">
        <label class="form-check-label" for="groupDiscount">Suggest Group Discounts</label>
      </div>

    </div>

    <!-- Theme textarea -->
    <div class="theme-field">
      <label for="tripTheme" class="form-label">Trip Theme / Details</label> 
      <textarea class="form-control" id="tripTheme" name="tripTheme" placeholder="Enter your trip theme" rows="5" maxlength="255"></textarea>
    </div>

    <!-- Submit button -->
    <div class="submit-container">
      <button type="submit" class="btn btn-primary">Generate my trip!</button>
    </div>
  </div>
</form>

<!-- Add this script at the bottom of the file -->
<script>
document.getElementById('tripForm').addEventListener('submit', function(e) {
    // Show loading animation
    document.getElementById('loadingAnimation').style.display = 'block';
    
    // Hide the form while loading
    this.style.opacity = '0.5';
    this.style.pointerEvents = 'none';
});

// Modified script for instant scrolling
document.addEventListener('DOMContentLoaded', function() {
    if (window.location.pathname === '/trip_generator') {
        const button = document.querySelector('.displayUserQueries');
        if (button) {
            button.scrollIntoView({ 
                block: 'start'
            });
        }
    }
});

document.addEventListener('DOMContentLoaded', function() {
    const dateInputs = document.querySelectorAll('.date-input');
    
    dateInputs.forEach(input => {
        // Set min date to today
        const today = new Date().toISOString().split('T')[0];
        input.min = today;

        // Add input event listener for manual entry
        input.addEventListener('keypress', function(e) {
            // Allow only numbers and forward slash
            if (!/[\d/]/.test(e.key) && e.key !== 'Backspace' && e.key !== 'Delete') {
                e.preventDefault();
            }
            
            // Auto-add slashes
            if (e.key.match(/\d/)) {
                const value = this.value.replace(/\D/g, '');
                if (value.length === 2 || value.length === 4) {
                    this.value = this.value + '/';
                }
            }
        });

        // Convert DD/MM/YYYY to YYYY-MM-DD when losing focus
        input.addEventListener('blur', function() {
            if (this.value && this.value.match(/^\d{2}\/\d{2}\/\d{4}$/)) {
                const [day, month, year] = this.value.split('/');
                const isoDate = `${year}-${month}-${day}`;
                if (isValidDate(isoDate)) {
                    this.value = isoDate;
                } else {
                    this.value = '';
                    alert('Please enter a valid date in DD/MM/YYYY format');
                }
            }
        });
    });
});

function isValidDate(dateString) {
    const date = new Date(dateString);
    return date instanceof Date && !isNaN(date);
}

function triggerDatePicker(dateInput) {
    // Reset the date input value
    const currentValue = dateInput.value;
    dateInput.value = '';
    dateInput.value = currentValue;
    
    // Show the picker
    if (typeof dateInput.showPicker === 'function') {
        dateInput.showPicker();
    } else {
        dateInput.focus();
        dateInput.click();
    }
}

function updateTextInput(dateInput) {
    const textInput = dateInput.previousElementSibling;
    if (dateInput.value) {
        const [year, month, day] = dateInput.value.split('-');
        textInput.value = `${day}/${month}/${year}`;
    }
}

function formatDateInput(input) {
    // Remove any non-digit characters
    let value = input.value.replace(/\D/g, '');
    
    // Add slashes automatically
    if (value.length > 0) {
        if (value.length > 2) {
            value = value.slice(0,2) + '/' + value.slice(2);
        }
        if (value.length > 5) {
            value = value.slice(0,5) + '/' + value.slice(5);
        }
        if (value.length > 10) {
            value = value.slice(0,10);
        }
    }
    
    input.value = value;

    // Validate date
    if (value.length === 10) {
        const [day, month, year] = value.split('/');
        const date = new Date(year, month - 1, day);
        const isValid = date.getDate() == day && (date.getMonth() + 1) == month && date.getFullYear() == year;
        
        if (!isValid) {
            input.setCustomValidity('Please enter a valid date');
        } else {
            input.setCustomValidity('');
            // Update the hidden date input
            const dateInput = input.nextElementSibling;
            dateInput.value = `${year}-${month}-${day}`;
        }
    }
}

// Initialize date inputs
document.addEventListener('DOMContentLoaded', function() {
    const dateInputs = document.querySelectorAll('#date-picker-hidden');
    const today = new Date().toISOString().split('T')[0];
    
    dateInputs.forEach(input => {
        // Set min date to today
        input.min = today;
        
        // Initialize any existing values
        if (input.value) {
            updateTextInput(input);
        }
    });
});
</script>

<style>
.date-input-container {
    position: relative;
    display: flex;
    align-items: center;
}

#date-picker-button {
    position: absolute;
    right: 10px;
    font-size: 16px;
    color: #666;
    pointer-events: none;  /* Makes the icon non-interactive */
}

#date-picker-hidden {
    position: absolute;
    right: 5px;
    opacity: 0;
    width: 24px;
    height: 24px;
    cursor: pointer;
    z-index: 1;  /* Ensures it's clickable */
    color: black;
}

.form-control {
    padding-right: 30px;
}
</style>